<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>objUIItem</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>604</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_inherited</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LOCAL VARIABLES

///////////////////////////////////////////////////////
//  INHERITED
////
//double_click = true;

///////////////////////////////////////////////////////
//  DRAWING
////
srf_text = surface_create( width, height );


///////////////////////////////////////////////////////
//  CURSOR
////
cursor_pos = 0;
prev_cursor_pos = cursor_pos;

cursor_blink = current_time;
cursor_blink_time = 500; // time in milliseconds to blink the cursor on and off

text_select = false;
prev_text_select = text_select;

cursor_select_start = 0;
cursor_select_end   = 0;


///////////////////////////////////////////////////////
//  DATA
////

text = "";         // the actual typed text
prev_text = text; // the text as it was in the previous frame

text_wrapped = string_wrap( text, width, true );
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>604</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_inherited</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(objUIManager.selected_item == id)
{
    if(text_select &amp;&amp; !mouse_check_button(mb_left))
    {
        update_user_input(cursor_pos, cursor_select_start, cursor_select_end );
    }
    else
        update_user_input(cursor_pos);
        
    text = user_input;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// ACTIVATED

if(ui_event == UI_ACTIVATE)
{
    keyboard_string = "";
    user_input = text;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT CLICKED

if(ui_event == UI_LCLICK)
{
    cursor_pos = ui_textbox_calculate_cursor_loc( mouse_x, mouse_y, id );
    cursor_select_start = cursor_pos;
    
    text_select = false;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT HELD

if(ui_event == UI_LHOLD)
{
    cursor_select_end = ui_textbox_calculate_cursor_loc( mouse_x, mouse_y, id );
    text_select = true;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT RELEASED

if(ui_event == UI_LRELEASE)
{
    if(cursor_select_end &lt; cursor_select_start)
    {
        var swap = cursor_select_start;
        
        cursor_select_start = cursor_select_end;
        cursor_select_end = swap;
    }
    
    //var temp = string_insert("^", text, (cursor_select_start + 1) );
    //temp = string_insert("^", temp, (cursor_select_end + 1) );
    //show_debug_message("|" + temp + "|" + chr(10));
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///INHERITED
if(draw_disabled)
    exit;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Draw

///////////////////////////////////////////////////////////
//  DEBUG
////
    //draw_text(10,10,"FPS: "+string(fps));
    
    //draw border
    draw_rectangle_colour( x, y, x+width, y+height, c_red, c_red, c_red, c_red, true);


///////////////////////////////////////////////////////////
//  UPDATE
////
    // Whether or not srf_text needs to be redrawn
    // due to its memory being freed, or the width or height changing
    var redraw = ( !surface_exists( srf_text ) ||
                   width  != prev_width ||
                   height != prev_height );
    
    
    if( (objUIManager.selected_item == id) || new || redraw)
    {
        // make sure it draws at least once
        new = false;
        
        ///////////////////////////////////////////////////////////
        //  REDRAW
        ////
            if( redraw )
            {
                prev_width  = width;
                prev_height = height;
                
                surface_free( srf_text );
                srf_text = surface_create( width, height );
            }
        
        
        ///////////////////////////////////////////////////////////
        //  TEXT
        ////
            if(abs(cursor_select_start - cursor_select_end) &lt;= 1)
                text_select = false;
                
            if( text != prev_text || redraw)
            {
                if(!text_select)
                    cursor_pos += ((string_length_full(text) - string_length_full(prev_text)) * !keyboard_check(vk_delete));
                else
                    cursor_pos += global.keyboard_string_length;
                prev_text = text;
                
                text_wrapped = string_wrap( text, width, true );
                
                text_select = false;
                
                surface_set_target(srf_text);
                    draw_clear_alpha( c_black, 0 );
                    draw_text( 0, 0, text_wrapped );
                surface_reset_target();
            }
         
           
        ///////////////////////////////////////////////////////////
        //  CURSOR
        ////
            //////////////
            //  SETUP
            ////
                var lines = string_wrap_list( text, width, true );
                var cursor = ui_textbox_cursor_coords( lines, cursor_pos );
                
            //////////////
            //  KEYBOARD
            ////
                // SHIFT
                if(keyboard_check_pressed(vk_shift))
                {
                    if(!text_select)
                    {
                        cursor_select_start = cursor_pos;
                        cursor_select_end   = cursor_pos;
                    }
                        
                    text_select = true;
                }
            
                // LEFT
                if(keyboard_check_pressed(vk_left))
                {
                    cursor_pos -= 1;
                    
                    if(!keyboard_check(vk_shift))
                        text_select = false;
                }
                    
                // RIGHT
                if(keyboard_check_pressed(vk_right))
                {
                    cursor_pos += 1;
                    
                    if(!keyboard_check(vk_shift))
                        text_select = false;
                }
                    
                // UP
                if(keyboard_check_pressed(vk_up))
                {
                    if(cursor[LINE] &gt; 0)
                    {
                        //cursor[LINE] -= 1;
                        //cursor[ROW] = min(cursor[ROW], string_length(string_list_get( lines, (cursor[LINE]), "text" )));
                        ///*
                        var prev_line_len = (string_length(string_list_get( lines, (cursor[LINE] - 1), "text" )));
                            prev_line_len += !string_list_get( lines, (cursor[LINE] - 1), "wrapped" );
                        cursor_pos -= cursor[ROW];
                        cursor_pos -= prev_line_len;//+ !string_list_get( lines, (cursor[LINE] - 1), "wrapped" );
                        cursor_pos += min( cursor[ROW], prev_line_len );
                        //*/
                    }
                }
                
                // DOWN
                if(keyboard_check_pressed(vk_down))
                {
                    if(cursor[LINE] &lt; ds_list_size(lines) - 1)
                    {
                        var line_len      = (string_length(string_list_get( lines, cursor[LINE], "text" )));
                            next_line_len = (string_length(string_list_get( lines, (cursor[LINE] + 1), "text" )));
                            
                            line_len += !string_list_get( lines, cursor[LINE], "wrapped" );
                            next_line_len += !string_list_get( lines, (cursor[LINE] + 1), "wrapped" );
                        
                        cursor_pos -= cursor[ROW];
                        cursor_pos += line_len;
                        cursor_pos += min( cursor[ROW], next_line_len );
                    }
                }
                
                // HOME
                if(keyboard_check_pressed(vk_home))
                {
                    cursor_pos -= cursor[ROW];
                }
                
                // END
                if(keyboard_check_pressed(vk_end))
                {
                    cursor_pos += (string_length(string_list_get( lines, cursor[LINE], "text" )) - cursor[ROW]);
                }
                
            //////////////
            //  UPDATE CURSOR
            ////
                cursor_pos = clamp( cursor_pos, 0, string_length(text) );
                
                
                if(cursor_pos != prev_cursor_pos)
                {
                    // reset cursor visibility
                    cursor_blink = current_time;
                    
                    cursor = ui_textbox_cursor_coords( lines, cursor_pos );
                        
                    prev_cursor_pos = cursor_pos;
                }
                
                
            //////////////
            //  DRAW CURSOR
            ////
                if((current_time - cursor_blink) &gt;= (cursor_blink_time * 2))
                    cursor_blink = current_time;
                
                if((current_time - cursor_blink) &lt;= cursor_blink_time)
                {
                    var str_height = string_height("W");
                    var cr = cursor[ROW] + 1;
                    
                    var cx = x + string_width(string_copy( string_list_get( lines, cursor[LINE], "text" ), 1, cr));
                    var cy = y + str_height * cursor[LINE];
                    
                    draw_line( cx, cy, cx, (cy + str_height) );
                }
                
                if(text_select)
                {
                    var cs = cursor_select_start,
                        ce = cursor_select_end;
                    if(ce &lt; cs)
                    {
                        var swap = cs;
                        cs = ce;
                        ce = swap;
                    }
                    
                    var sp = ui_textbox_cursor_coords( lines, cs ),
                        ep = ui_textbox_cursor_coords( lines, ce ),
                        sh = string_height("W"),
                        t1 = string_list_get( lines, sp[LINE], "text" ),
                        t2 = string_list_get( lines, ep[LINE], "text" );
                        
                        var x1 = x + string_width(string_copy( t1, 1, sp[ROW] + 1)),
                            x2 = x + string_width(string_copy( t2, 1, ep[ROW] + 1)),
                            y1 = y + sh * sp[LINE];
                            y2 = y + sh * ep[LINE];
                        
                        if(sp[LINE] == ep[LINE])
                        {
                            draw_rectangle_colour( x1, y1, x2, (y1 + sh), c_blue, c_blue, c_blue, c_blue, false );
                        }
                        else
                        {
                            draw_rectangle_colour( x1, y1, x + string_width(t1), (y1 + sh), c_blue, c_blue, c_blue, c_blue, false );
                            
                            for(var i = 1; i &lt; (ep[LINE] - sp[LINE]); ++i)
                            {
                                var yy = (y1 + (i * sh));
                                draw_rectangle_colour( x, yy, x + string_width(string_list_get( lines, (sp[LINE] + i), "text" )), (yy + sh), c_blue, c_blue, c_blue, c_blue, false );
                            }
                            
                            draw_rectangle_colour( x, y2, x2, (y2 + sh), c_blue, c_blue, c_blue, c_blue, false );
                        }
                }
            
                
            //////////////
            //  CLEANUP
            ////
            string_list_destroy(lines);
    }


draw_surface( srf_text, x, y );
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
