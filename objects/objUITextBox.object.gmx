<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>objUIItem</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>604</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_inherited</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LOCAL VARIABLES

///////////////////////////////////////////////////////
//  INHERITED
////
//double_click = true;

///////////////////////////////////////////////////////
//  DRAWING
////
srf_text = surface_create( width, height );


///////////////////////////////////////////////////////
//  CURSOR
////
cursor_pos = 0;
prev_cursor_pos = cursor_pos;

cursor_blink = current_time;
cursor_blink_time = 500; // time in milliseconds to blink the cursor on and off

text_select = false;
prev_text_select = text_select;

cursor_select_start = 0;
cursor_select_end   = 0;


///////////////////////////////////////////////////////
//  DATA
////

text = "";         // the actual typed text
prev_text = text; // the text as it was in the previous frame
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>604</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_inherited</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(objUIManager.selected_item == id)
{
    update_user_input(cursor_pos);
    text = user_input;
    
    //target_width = string_width_full(text);
    //target_height = string_height_full(text);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// ACTIVATED

if(ui_event == UI_ACTIVATE)
{
    keyboard_string = "";
    user_input = text;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT CLICKED

if(ui_event == UI_LCLICK)
{
    cursor_pos = ui_textbox_calculate_cursor_loc( mouse_x, mouse_y, id );
    cursor_select_start = cursor_pos;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT HELD

if(ui_event == UI_LHOLD)
{
    cursor_select_end = ui_textbox_calculate_cursor_loc( mouse_x, mouse_y, id );
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// LEFT RELEASED

if(ui_event == UI_LRELEASE)
{
    if(cursor_select_end &lt; cursor_select_start)
    {
        var swap = cursor_select_start;
        
        cursor_select_start = cursor_select_end;
        cursor_select_end = swap;
    }
    
    var temp = string_insert("^", text, (cursor_select_start + 1) );
    temp = string_insert("^", temp, (cursor_select_end + 1) );
    show_debug_message("|" + temp + "|" + chr(10));
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///INHERITED
if(draw_disabled)
    exit;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Draw

///////////////////////////////////////////////////////////
//  DEBUG
////
    //draw_text(10,10,"FPS: "+string(fps));
    
    //draw border
    draw_rectangle_colour( x, y, x+width, y+height, c_red, c_red, c_red, c_red, true);


///////////////////////////////////////////////////////////
//  UPDATE
////
    // Whether or not srf_text needs to be redrawn
    var redraw = ( !surface_exists( srf_text ) ||
                   width  != prev_width ||
                   height != prev_height );
    
    
    if( (objUIManager.selected_item == id) || new || redraw)
    {
        // make sure it draws at least once
        new = false;
        
        ///////////////////////////////////////////////////////////
        //  REDRAW
        ////
            if( redraw )
            {
                prev_width  = width;
                prev_height = height;
                
                surface_free( srf_text );
                srf_text = surface_create( width, height );
            }
        
        
        ///////////////////////////////////////////////////////////
        //  TEXT
        ////
            //////////////
            //  SETUP
            ////
                var text_wrapped = string_wrap( text, width, true ),
                    lines        = string_wrap_list( text, width, true );
                    
                
                
            if( text != prev_text || redraw)
            {
                cursor_pos += ((string_length_full(text) - string_length_full(prev_text)) * !keyboard_check(vk_delete));
                prev_text = text;
                
                text_select = false;
                
                surface_set_target(srf_text);
                    draw_clear_alpha( c_black, 0 );
                    draw_text( 0, 0, text_wrapped );
                surface_reset_target();
            }
         
           
        ///////////////////////////////////////////////////////////
        //  CURSOR
        ////
            var cursor = ui_textbox_cursor_coords( lines, cursor_pos );
        
            //////////////
            //  KEYBOARD
            ////
                // SHIFT
                if(keyboard_check_pressed(vk_shift))
                {
                    if(!text_select)
                    {
                        cursor_select_start = cursor_pos;
                        cursor_select_end   = cursor_pos;
                    }
                        
                    text_select = true;
                }
            
                // Left
                if(keyboard_check_pressed(vk_left))
                {
                    cursor_pos -= 1;
                    
                    if(!keyboard_check(vk_shift))
                        text_select = false;
                }
                    
                // Right
                if(keyboard_check_pressed(vk_right))
                {
                    cursor_pos += 1;
                    
                    if(!keyboard_check(vk_shift))
                        text_select = false;
                }
                    
                // Up
                if(keyboard_check_pressed(vk_up))
                {
                    if(cursor[LINE] &gt; 0)
                    {
                        //cursor[LINE] -= 1;
                        //cursor[ROW] = min(cursor[ROW], string_length(string_list_get( lines, (cursor[LINE]), "text" )));
                        ///*
                        var prev_line_len = (string_length(string_list_get( lines, (cursor[LINE] - 1), "text" )));
                            prev_line_len += !string_list_get( lines, (cursor[LINE] - 1), "wrapped" );
                        cursor_pos -= cursor[ROW];
                        cursor_pos -= prev_line_len;//+ !string_list_get( lines, (cursor[LINE] - 1), "wrapped" );
                        cursor_pos += min( cursor[ROW], prev_line_len );
                        //*/
                    }
                }
                
                // Down
                if(keyboard_check_pressed(vk_down))
                {
                    if(cursor[LINE] &lt; ds_list_size(lines))
                    {
                        //cursor[LINE] += 1;
                        //cursor[ROW] = min(cursor[ROW], string_length(string_list_get( lines, (cursor[LINE]), "text" )));
                        ///*
                        var line_len      = (string_length(string_list_get( lines, cursor[LINE], "text" )));
                            next_line_len = (string_length(string_list_get( lines, (cursor[LINE] + 1), "text" )));
                            
                            line_len += !string_list_get( lines, cursor[LINE], "wrapped" );
                            next_line_len += !string_list_get( lines, (cursor[LINE] + 1), "wrapped" );
                        
                        cursor_pos -= cursor[ROW];
                        cursor_pos += line_len;//+ !string_list_get( lines, cursor[LINE], "wrapped" );
                        cursor_pos += min( cursor[ROW], next_line_len );
                        //*/
                    }
                }
                
                // Home
                if(keyboard_check_pressed(vk_home))
                {
                    cursor_pos -= cursor[ROW];
                }
                
                // End
                if(keyboard_check_pressed(vk_end))
                {
                    cursor_pos += (string_length(string_list_get( lines, cursor[LINE], "text" )) - cursor[ROW]);
                }
                
            //////////////
            //  UPDATE CURSOR
            ////
                //cursor_pos = ui_textbox_cursor_pos( lines, cursor[LINE], cursor[ROW] );
                cursor_pos = clamp( cursor_pos, 0, string_length(text) );
                cursor = ui_textbox_cursor_coords( lines, cursor_pos );
                
                /* 
                if((cursor_row &gt;= line_len))// &amp;&amp; (line_len &gt; 0))
                {
                    if(cursor_line &lt; (ds_list_size(lines) - 1))
                    {
                        //line_len += string_list_get( lines, cursor_line, "wrapped" )
                        cursor_row -= line_len;
                        cursor_line += 1;
                    }
                    else
                        cursor_row = line_len;
                }
                
                if(cursor_row &lt; 0)
                {
                    if(cursor_line &gt; 0)
                    {
                        cursor_line -= 1;
                        cursor_row += string_length(string_list_get( lines, cursor_line, "text" ));
                    }
                    else if(cursor_row &lt; -1)
                        cursor_row = -1;
                }
                
                //cursor_line = clamp( cursor_line, 0, (ds_list_size(lines) - 1) );
                cursor_row  = clamp( cursor_row, -1, (string_length(string_list_get( lines, cursor_line, "text" )) - 1) );
                
                cursor_pos = ui_textbox_cursor_pos( lines, cursor_line, cursor_row );
                */
                
                if(cursor_pos != prev_cursor_pos)
                {
                    // reset cursor visibility
                    cursor_blink = 0;

                        show_debug_message("recalculating: " + string(cursor[LINE]) + " " + string(cursor[ROW]) + " " + string(cursor_pos));
                        //show_debug_message(string_replace_all(string_wrap(text, width, true), chr(10), "*"));
                        
                        show_debug_message(string_replace_all(string_insert("|",text_wrapped,cursor_pos+1), chr(10), "*"));
                        
                    prev_cursor_pos = cursor_pos;
                }
                
                
            //////////////
            //  DRAW CURSOR
            ////
                if((current_time - cursor_blink) &gt;= (cursor_blink_time * 2))
                    cursor_blink = current_time;
                
                if((current_time - cursor_blink) &lt;= cursor_blink_time)
                {
                    var str_height = string_height("W");
                    var cr = cursor[ROW] + 1;
                    
                    var cx = x + string_width(string_copy( string_list_get( lines, cursor[LINE], "text" ), 1, cr));
                    var cy = y + str_height * cursor[LINE];
                    
                    draw_line( cx, cy, cx, (cy + str_height) );
                }
            
                
            //////////////
            //  CLEANUP
            ////
            string_list_destroy(lines);
    }


draw_surface( srf_text, x, y );
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
